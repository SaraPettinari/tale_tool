<!DOCTYPE html>
<html lang="en">

<head lang="en">
    {% block head %}
    <title>TaleMiner</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <script src='https://cdn.plot.ly/plotly-2.9.0.min.js'></script>
    <!-- CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" type="text/css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
        integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">
    <!-- JavaScript -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.slim.min.js"
        integrity="sha256-u7e5khyithlIdTpu22PHhENmPcRdFiHRjhAuHcs05RI=" crossorigin="anonymous"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/script.js') }}">    </script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/plots.js') }}">    </script>
    <script src="https://cdn.jsdelivr.net/npm/dagre@0.8.5/dist/dagre.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3@7.8.5/dist/d3.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dagre-d3@0.6.4/dist/dagre-d3.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3-zoom@3.0.0/dist/d3-zoom.min.js"></script>
    {% endblock %}
    <style>
        #graph-container {
            margin-top: 20px;
        }

        #toggle-button,
        #download-button {
            margin-left: 10px;
        }

        .card {
            margin-bottom: 20px;
        }

        .navbar-brand {
            font-weight: bold;
            font-size: 1.5rem;
        }

        .btn-nav {
            font-size: 0.9rem;
        }

        .offcanvas-header {
            background-color: #f8f9fa;
        }

        .card-header {
            background-color: #f8f9fa;
        }

        .btn-outline-secondary {
            border-color: #6c757d;
        }

        .table th,
        .table td {
            vertical-align: middle;
        }

        .container-fluid {
            max-width: 1400px;
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm">
        <div class="container-fluid">
            <a class="navbar-brand" href="/">DFG-enhancement</a>
        </div>

    </nav>

    <nav class="navbar navbar-expand-lg navbar-light justify-content-center">
        <div class="btn-group">
            <form action="{{ url_for('enhancement.get_global_plot') }}" method="GET"
                onsubmit="updateHiddenInputs()">
                <input type="checkbox" class="btn-check" id="btn-check-performance" name="performance" value="1"
                    autocomplete="off">
                <label class="btn btn-outline-light" for="btn-check-performance">
                    <i class="bi bi-clock-history" title="See Performance Graph"></i>
                </label>

                <input type="checkbox" class="btn-check" id="btn-check-space" name="space" value="1"
                    autocomplete="off">
                <label class="btn btn-outline-light" for="btn-check-space">
                    <i class="bi bi-map" title="See Space Plot"></i>
                </label>

                <input type="checkbox" class="btn-check" id="btn-check-time" name="time" value="1"
                    autocomplete="off">
                <label class="btn btn-outline-light" for="btn-check-time">
                    <i class="bi bi-calendar-range" title="See Time Plot"></i>
                </label>

                <input type="checkbox" class="btn-check" id="btn-check-battery" name="battery" value="1"
                    autocomplete="off">
                <label class="btn btn-outline-light" for="btn-check-battery">
                    <i class="bi bi-battery-half" title="See Battery Plot"></i>
                </label>

                <input type="checkbox" class="btn-check" id="btn-check-msg" name="communication" value="1"
                    autocomplete="off">
                <label class="btn btn-outline-light" for="btn-check-msg">
                    <i class="bi bi-chat" title="See Communication Plot"></i>
                </label>

                <button type="submit" class="btn btn-primarybtn btn-outline-light">Apply</button>
            </form>
        </div>
    </nav>
    <div class="container-fluid mt-3 card">
        <div class="d-flex justify-content-end mb-3">
            <div class="btn-group">
                <button id="toggle-button" class="btn btn-outline-secondary" title="Change Graph Direction"><i
                        class="bi bi-arrow-repeat" aria-hidden="true"></i>
                </button>
                <button onclick="downloadGraph()" class="btn btn-outline-secondary" title="Download SVG"><i
                        class="bi bi-download" aria-hidden="true"></i>
                </button>
            </div>
        </div>
        <div id="graph-container" style="height: 300px;"></div>
    </div>

    <div class="container-fluid mt-3">
        <div class="col-md-6 card">


        </div>

        <!-- Query over activities -->
        <div hidden class="col-4">
            <form action="{{ url_for('enhancement.see_plot') }}" method="GET">
                <input id="activity_id" name="activity_id" value="" />
                <div id="activity_space">
                    <input id="space" name="space" value="" />
                    <input id="see_space_graph" type="submit" />
                </div>
                <div id="activity_time">
                    <input id="time" name="time" value="" />
                    <input id="see_time_graph" type="submit" />
                </div>
                <div id="activity_energy">
                    <input id="energy" name="energy" value="" />
                    <input id="see_energy_graph" type="submit" />
                </div>
            </form>
        </div>
        <!-- Context menu -->
        <div id="context-menu" class="context-menu">
            <div class="context-menu-title">Measures</div>
            <div id="space-menu" class="context-menu-option">Space</div>
            <div id="time-menu" class="context-menu-option">Time</div>
            <div id="energy-menu" class="context-menu-option">Energy</div>
        </div>
        <div class="row">
            <div class="col-md-6">
                {% if session.measures %}
                <div class="row">
                    {% set activity_plots = session.measures.get(session.current_activity, session.measures['global']) %}
                    {% if activity_plots.space %}
                    <div class="col">
                        <div id="space_div" class="card">
                            <div class="card-body">
                                <h5 class="card-title">Space Perspective</h5>
                                <!--<label class="toggle">
                                    <input type="checkbox">
                                    <span class="slider"></span>
                                    <span class="labels" data-on="3D" data-off="Heatmap"></span>
                                </label>-->
                                {% include activity_plots.space %}
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    {% if activity_plots.time %}
                    <div class="col">
                        <div id="time_div" class="card">
                            <div class="card-body">
                                <h5 class="card-title">Time Perspective</h5>
                                {% include activity_plots.time %}
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    {% if activity_plots.battery %}
                    <div class="col">
                        <div id="battery_div" class="card">
                            <div class="card-body">
                                <h5 class="card-title">Battery Perspective</h5>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>
                {% endif %}
                <div class="row">
                    <div class="col">
                        <div class="card"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script>
        const response_data = {{ session.response_data|default ("") | tojson }};
        generate_dagre(response_data);

        function updateHiddenInputs() {
            // Iterate through all checkboxes
            document.querySelectorAll('.btn-check').forEach(function (checkbox) {
                // Check if the checkbox is checked
                if (checkbox.checked) {
                    // Create a hidden input if the checkbox is checked
                    let hiddenInput = document.createElement('input');
                    hiddenInput.type = 'hidden';
                    hiddenInput.name = checkbox.name;
                    hiddenInput.value = checkbox.value;
                    // Append the hidden input to the form
                    checkbox.closest('form').appendChild(hiddenInput);
                }
            });
        }
    </script>
</body>

</html>