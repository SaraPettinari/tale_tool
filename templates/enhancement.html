<!DOCTYPE html>
<html lang="en">

<head>
    {% block head %}
    <title>RoboTrace</title>
    <link rel="icon" href="/static/images/robotrace.png" type="image/x-icon" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <script src='https://cdn.plot.ly/plotly-2.9.0.min.js'></script>
    <!-- CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" type="text/css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
        integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">
    <!-- JavaScript -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.slim.min.js"
        integrity="sha256-u7e5khyithlIdTpu22PHhENmPcRdFiHRjhAuHcs05RI=" crossorigin="anonymous"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/script.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/plots.js') }}"></script>
    <script src="https://cdn.jsdelivr.net/npm/dagre@0.8.5/dist/dagre.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3@7.8.5/dist/d3.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dagre-d3@0.6.4/dist/dagre-d3.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3-zoom@3.0.0/dist/d3-zoom.min.js"></script>
    {% endblock %}
    <style>
        body,
        html {
            height: 100%;
            margin: 0;
            display: flex;
            flex-direction: column;
        }

        /* Navbar */
        .navbar {
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        /* Sidebar */
        .sidebar {
            width: 250px;
            background-color: #343a40;
            color: white;
            padding: 20px;
            height: 100vh;
            position: fixed;
            overflow-y: auto;
        }

        .sidebar .nav-link {
            color: white;
        }

        /* Content Area */
        .content {
            margin-left: 250px;
            padding: 20px;
            overflow-y: auto;
            flex-grow: 1;
        }

        .container-fluid {
            max-width: 1400px;
        }

        /* Plot Cards */
        .plot-card {
            margin-bottom: 20px;
        }

        /* Collapsible Plots */
        .collapse-toggle {
            cursor: pointer;
            color: #5001b8;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm">
        <div class="container-fluid">
            <a class="navbar-brand" style="font-size: 1.5rem;" href="/">RoboTrace-enhancement</a>
        </div>
    </nav>

    <!-- Sidebar -->
    <div class="d-flex flex-column flex-lg-row">
        <div class="sidebar">
            <nav class="navbar navbar-dark">
                <p class="navbar-brand">Perspectives</p>
                <div class="nav flex-column">
                    <form action="{{ url_for('enhancement.get_global_plot') }}" method="GET">
                        <input type="checkbox" class="btn-check" id="btn-check-performance" name="performance" value="1">
                        <label class="nav-link btn btn-outline-light" for="btn-check-performance">
                            <i class="fa fa-clock" title="See Performance Graph"></i> Performance
                        </label>
                        <input type="checkbox" class="btn-check" id="btn-check-space" name="space" value="1">
                        <label class="nav-link btn btn-outline-light" for="btn-check-space">
                            <i class="fa fa-map" title="See Space Plot"></i> Space
                        </label>
                        <input type="checkbox" class="btn-check" id="btn-check-time" name="time" value="1">
                        <label class="nav-link btn btn-outline-light" for="btn-check-time">
                            <i class="fa fa-calendar" title="See Time Plot"></i> Time
                        </label>
                        <input type="checkbox" class="btn-check" id="btn-check-battery" name="battery" value="1">
                        <label class="nav-link btn btn-outline-light" for="btn-check-battery">
                            <i class="fa fa-battery-half" title="See Battery Plot"></i> Battery
                        </label>
                        <input type="checkbox" class="btn-check" id="btn-check-msg" name="communication" value="1">
                        <label class="nav-link btn btn-outline-light" for="btn-check-msg">
                            <i class="fa fa-comment" title="See Communication Plot"></i> Communication
                        </label>
                        <div class="d-flex justify-content-center">
                            <button type="submit" class="btn btn-outline-light">Apply</button>
                        </div>
                    </form>
                </div>
            </nav>
        </div>
    </div>

    <div class="content">
        <div class="container-fluid">
                <!-- Process Area -->
                <div class="plot-card card">
                    <div class="card-header">
                        <span class="collapse-toggle" data-bs-toggle="collapse" data-bs-target="#control_flow">
                            <i class="fa fa-spinner"></i> Control-flow Perspective
                        </span>
                    </div>
                    <div id="control_flow" class="collapse show card-body">
                        <div class="d-flex justify-content-end mb-3">
                            <div class="btn-group">
                                <button id="toggle-button" class="btn btn-outline-secondary" title="Change Graph Direction"><i
                                        class="bi bi-arrow-repeat" aria-hidden="true"></i>
                                </button>
                                <button onclick="downloadGraph()" class="btn btn-outline-secondary" title="Download SVG"><i
                                        class="bi bi-download" aria-hidden="true"></i>
                                </button>
                            </div>
                        </div>
                        <div id="graph-container" style="height: 300px;"></div>
                    </div>
                </div>
           
        </div>


        <!-- Plots Area -->
        <div class="container-fluid mt-3">
            <div class="row">
                {% if session.measures %}
                {% set activity_plots = session.measures.get(session.current_activity, session.measures['global'])
                %}

                <!-- Space Plot -->
                {% if activity_plots.space %}
                <div class="col-md-6">
                    <div class="plot-card card">
                        <div class="card-header">
                            <span class="collapse-toggle" data-bs-toggle="collapse" data-bs-target="#space_div">
                                <i class="fa fa-map"></i> Space Perspective
                            </span>
                        </div>
                        <div id="space_div" class="collapse show card-body">
                            {% for plot in activity_plots.space %}
                            {% include plot %}
                            {% endfor %}
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- Time Plot -->
                {% if activity_plots.time %}
                <div class="col-md-6">
                    <div class="plot-card card">
                        <div class="card-header">
                            <span class="collapse-toggle" data-bs-toggle="collapse" data-bs-target="#time_div">
                                <i class="fa fa-calendar"></i> Time Perspective
                            </span>
                        </div>
                        <div id="time_div" class="collapse show card-body">
                            {% for plot in activity_plots.time %}
                            {% include plot %}
                            {% endfor %}
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- Battery Plot -->
                {% if activity_plots.battery %}
                <div class="col-md-6">
                    <div class="plot-card card">
                        <div class="card-header">
                            <span class="collapse-toggle" data-bs-toggle="collapse" data-bs-target="#battery_div">
                                <i class="fa fa-battery-half"></i> Battery Perspective
                            </span>
                        </div>
                        <div id="battery_div" class="collapse show card-body">
                            {% for plot in activity_plots.battery %}
                            {% include plot %}
                            {% endfor %}
                        </div>
                    </div>
                </div>
                {% endif %}


                {% else %}
                <p>No measures data available to display.</p>
                {% endif %}
            </div>
        </div>
    </div>

    <script>
        const response_data = {{ session.response_data|default ("") | tojson }};
        generate_dagre(response_data);
    </script>
</body>

</html>